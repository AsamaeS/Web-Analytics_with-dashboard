<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Analytics Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=IBM+Plex+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="app-logo">Analytics Platform</div>
                <!-- Project Selector -->
                <div id="project-selector-container" class="project-selector-wrapper">
                    <div class="project-empty-state">
                        <p class="text-muted text-xs">Loading projects...</p>
                    </div>
                </div>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-page="overview">Overview</a>
                <a href="#" class="nav-item" data-page="decision"
                    style="border-left: 3px solid #0078d4; background: rgba(0,120,212,0.1);">Decision Intelligence</a>
                <a href="#" class="nav-item" data-page="sources">Sources</a>
                <a href="#" class="nav-item" data-page="analytics">Analytics</a>
                <a href="#" class="nav-item" data-page="keywords">Keywords</a>
                <a href="#" class="nav-item" data-page="blocking">Blocking & Errors</a>
                <a href="#" class="nav-item" data-page="reports">Reports</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Overview Page -->
            <div class="page-section active" id="overview-page">
                <div class="content-header">
                    <h1 class="content-title">Overview</h1>
                    <p class="content-subtitle">System-wide crawl statistics and health metrics</p>
                </div>
                <div class="content-body">
                    <!-- Stats Grid -->
                    <div class="grid grid-cols-4 mb-4">
                        <div class="kpi-card">
                            <div class="stat-label">Total Sources</div>
                            <div class="stat-value text-gradient" id="stat-total-sources">0</div>
                        </div>
                        <div class="kpi-card">
                            <div class="stat-label">Documents Collected</div>
                            <div class="stat-value" id="stat-total-documents">0</div>
                        </div>
                        <div class="kpi-card">
                            <div class="stat-label">Active Crawls</div>
                            <div class="stat-value" id="stat-active-crawls">0</div>
                        </div>
                        <div class="kpi-card">
                            <div class="stat-label">Blocked Sources</div>
                            <div class="stat-value" id="stat-blocked-sources">0</div>
                        </div>
                    </div>

                    <!-- Charts Grid -->
                    <div class="grid grid-cols-2">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Crawl Activity (30 Days)</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="overviewTimelineChart"></canvas>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Source Health Distribution</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="overviewHealthChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sources Page -->
            <div class="page-section" id="sources-page">
                <div class="content-header">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="content-title">Sources</h1>
                            <p class="content-subtitle">Manage crawl sources and configurations</p>
                        </div>
                        <button class="btn btn-primary" id="btn-add-source">Add Source</button>
                    </div>
                </div>
                <div class="content-body">
                    <div class="card">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>URL</th>
                                        <th>Schedule</th>
                                        <th>Rate Limit</th>
                                        <th>Max Pages</th>
                                        <th>Documents</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="sources-table-body">
                                    <tr>
                                        <td colspan="9" class="text-muted">Loading sources...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Page -->
            <div class="page-section" id="analytics-page">
                <div class="content-header">
                    <h1 class="content-title">Analytics</h1>
                    <p class="content-subtitle">Content distribution and performance metrics</p>
                </div>
                <div class="content-body">
                    <div class="grid grid-cols-4 mb-4">
                        <div class="kpi-card">
                            <div class="stat-label">Total Documents</div>
                            <div class="stat-value text-gradient" id="analytics-total-docs">0</div>
                        </div>
                        <div class="kpi-card">
                            <div class="stat-label">Active Sources</div>
                            <div class="stat-value" id="analytics-active-sources">0</div>
                        </div>
                        <div class="kpi-card">
                            <div class="stat-label">Platforms</div>
                            <div class="stat-value" id="analytics-platforms">0</div>
                        </div>
                        <div class="kpi-card">
                            <div class="stat-label">Avg Doc/Source</div>
                            <div class="stat-value" id="analytics-avg-docs">0</div>
                        </div>
                    </div>

                    <!-- Charts Row 1 -->
                    <div class="grid grid-cols-2 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Documents per Source</h3>
                                <p class="card-description">Total volume of content collected from each configured
                                    source</p>
                            </div>
                            <div class="chart-container">
                                <canvas id="documentsChart"></canvas>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Content Distribution</h3>
                                <p class="card-description">Breakdown of content by platform type (Web, Social, RSS)</p>
                            </div>
                            <div class="chart-container">
                                <canvas id="platformComparisonChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row 2 -->
                    <div class="grid grid-cols-2">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Source Health Status</h3>
                                <p class="card-description">Real-time status of all active and configured sources</p>
                            </div>
                            <div class="chart-container">
                                <canvas id="contentTypeChart"></canvas>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">System Performance Radar</h3>
                                <p class="card-description">Multi-metric analysis of system capabilities</p>
                            </div>
                            <div class="chart-container">
                                <canvas id="radarChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Keywords Page -->
            <div class="page-section" id="keywords-page">
                <div class="content-header">
                    <h1 class="content-title">Content Keywords</h1>
                    <p class="content-subtitle">Intelligent keyword extraction with relevance analysis</p>
                </div>
                <div class="content-body">
                    <!-- Filters -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h3 class="card-title">Filters</h3>
                        </div>
                        <div style="padding: var(--spacing-4);">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Date Range</label>
                                    <select class="form-input" id="keyword-date-range">
                                        <option value="7">Last 7 days</option>
                                        <option value="30" selected>Last 30 days</option>
                                        <option value="90">Last 90 days</option>
                                        <option value="365">Last year</option>
                                        <option value="all">All time</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Platform Type</label>
                                    <select class="form-input" id="keyword-platform-filter">
                                        <option value="all">All Platforms</option>
                                        <option value="web">Web Only</option>
                                        <option value="social">Social Media</option>
                                        <option value="twitter">Twitter</option>
                                        <option value="reddit">Reddit</option>
                                        <option value="youtube">YouTube</option>
                                        <option value="linkedin">LinkedIn</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Min Frequency</label>
                                    <input type="number" class="form-input" id="keyword-min-freq" value="2" min="1">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Top N Keywords</label>
                                    <input type="number" class="form-input" id="keyword-top-n" value="20" min="5"
                                        max="100">
                                </div>
                            </div>
                            <div class="flex gap-2" style="margin-top: var(--spacing-4);">
                                <button class="btn btn-primary btn-sm" onclick="applyKeywordFilters()">Apply
                                    Filters</button>
                                <button class="btn btn-secondary btn-sm" onclick="resetKeywordFilters()">Reset</button>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Summary -->
                    <div class="grid grid-cols-4 mb-4">
                        <div class="kpi-card">
                            <div class="stat-label">Total Keywords</div>
                            <div class="stat-value text-gradient" id="kw-stat-total">0</div>
                        </div>
                        <div class="kpi-card">
                            <div class="stat-label">Unique Phrases</div>
                            <div class="stat-value" id="kw-stat-phrases">0</div>
                        </div>
                        <div class="kpi-card">
                            <div class="stat-label">Avg Frequency</div>
                            <div class="stat-value" id="kw-stat-avg">0</div>
                        </div>
                        <div class="kpi-card">
                            <div class="stat-label">Coverage</div>
                            <div class="stat-value" id="kw-stat-coverage">0%</div>
                        </div>
                    </div>

                    <!-- Keyword Chart & Export -->
                    <div class="card">
                        <div class="card-header">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="card-title">Top Keywords by Frequency</h3>
                                    <p class="card-description">NLP-extracted, stopwords removed, lemmatized</p>
                                </div>
                                <div class="flex gap-2">
                                    <button class="btn btn-secondary btn-sm" onclick="exportKeywordReport('csv')">
                                        Export CSV
                                    </button>
                                    <button class="btn btn-secondary btn-sm" onclick="exportKeywordReport('pdf')">
                                        Export PDF
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="keywordsChart"></canvas>
                        </div>
                    </div>

                    <!-- Keyword Table -->
                    <div class="card mt-4">
                        <div class="card-header">
                            <h3 class="card-title">Keyword Details</h3>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Keyword</th>
                                        <th>Frequency</th>
                                        <th>Relevance</th>
                                        <th>Coverage</th>
                                        <th>Trend</th>
                                    </tr>
                                </thead>
                                <tbody id="keywords-table-body">
                                    <tr>
                                        <td colspan="5" class="text-muted">Loading keywords...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Blocking & Errors Page -->
            <div class="page-section" id="blocking-page">
                <div class="content-header">
                    <h1 class="content-title">Blocking & Errors</h1>
                    <p class="content-subtitle">HTTP errors, rate limits, and access restrictions</p>
                </div>
                <div class="content-body">
                    <div class="grid grid-cols-3 mb-4">
                        <div class="kpi-card">
                            <div class="stat-label">Blocked Sources</div>
                            <div class="stat-value text-gradient" id="blocking-stat-blocked">0</div>
                        </div>
                        <div class="kpi-card">
                            <div class="stat-label">HTTP 403/429 Errors</div>
                            <div class="stat-value" id="blocking-stat-http">0</div>
                        </div>
                        <div class="kpi-card">
                            <div class="stat-label">Robot.txt Blocks</div>
                            <div class="stat-value" id="blocking-stat-robots">0</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Blocked Sources</h3>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Source Name</th>
                                        <th>Content Type</th>
                                        <th>Block Reason</th>
                                        <th>Timestamp</th>
                                    </tr>
                                </thead>
                                <tbody id="blocked-sources-table">
                                    <tr>
                                        <td colspan="4" class="text-muted">No blocked sources</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Decision Intelligence Page -->
            <div class="page-section" id="decision-page">
                <div class="content-header flex justify-between items-center">
                    <div>
                        <h1 class="content-title">Decision Intelligence</h1>
                        <p class="content-subtitle">Executive strategic analysis grounded in NoSQL truth</p>
                    </div>
                    <div class="flex gap-2">
                        <span class="status-badge running" id="decision-status">SYSTEM STABLE</span>
                    </div>
                </div>

                <!-- Project Keywords Display -->
                <div class="card mb-4" style="padding: 1rem; background: hsl(var(--muted) / 0.3);">
                    <div class="flex items-center gap-2 mb-2">
                        <span
                            style="font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: hsl(var(--muted-foreground));">Active
                            Project Keywords:</span>
                    </div>
                    <div id="current-project-keywords">
                        <span class="text-muted">No project selected</span>
                    </div>
                </div>

                <div class="decision-workspace">
                    <div class="intelligence-canvas">
                        <!-- TL;DR Card -->
                        <div class="card mb-4"
                            style="background: linear-gradient(135deg, hsl(var(--card)), hsl(var(--accent) / 0.05)); border: 1px solid hsl(var(--accent) / 0.2);">
                            <div class="card-header flex justify-between">
                                <h3 class="card-title">Executive Summary (TL;DR)</h3>
                                <button class="btn btn-sm btn-secondary"
                                    onclick="refreshDecisionSummary()">Refreshed</button>
                            </div>
                            <div id="decision-tldr-content" class="text-lg font-medium" style="line-height: 1.6;">
                                Loading executive briefing...
                            </div>
                        </div>

                        <!-- Main Grid -->
                        <div class="grid grid-cols-2 mb-4">
                            <div class="card highlight-card">
                                <div class="card-header">
                                    <h3 class="card-title">Signal Radar</h3>
                                    <p class="card-description">Emerging trends & volume anomalies</p>
                                </div>
                                <div class="chart-container" style="height: 250px;">
                                    <canvas id="signalRadarChart"></canvas>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Strategic Insights</h3>
                                </div>
                                <div id="strategic-insights-list" class="flex flex-direction-column gap-3">
                                    <!-- Dynamic Insights -->
                                </div>
                            </div>
                        </div>

                        <!-- Evidence / Grounding -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Narrative Clusters</h3>
                                <p class="card-description">Semantic proximity of collected documents</p>
                            </div>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="conceptClusterChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- AI Sidecar -->
                    <aside class="decision-sidecar glass-card">
                        <div class="sidecar-header">
                            <div class="flex items-center gap-2">
                                <div style="width: 10px; height: 10px; border-radius: 50%; background: #0078d4;"></div>
                                <h3 class="card-title">Decision Assistant</h3>
                            </div>
                            <p class="text-xs text-muted">Grounded in local NoSQL</p>
                        </div>
                        <div class="sidecar-chat" id="sidecar-chat-history">
                            <div class="chat-msg assistant">
                                Hello. I have analyzed the current data volume. How can I help you reduce uncertainty
                                today?
                            </div>
                        </div>
                        <div class="sidecar-input">
                            <input type="text" id="sidecar-query-input" placeholder="Ask about trends..."
                                class="form-input">
                            <button class="btn btn-primary btn-sm" onclick="sendSidecarQuery()">Ask</button>
                        </div>
                    </aside>
                </div>
            </div>

            <!-- Reports Page -->
            <div class="page-section" id="reports-page">
                <div class="content-header">
                    <h1 class="content-title">Reports</h1>
                    <p class="content-subtitle">Export and download analytics data</p>
                </div>
                <div class="content-body">
                    <div class="grid grid-cols-2">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Keyword Frequency Report</h3>
                                <p class="card-description">Top keywords with occurrence counts</p>
                            </div>
                            <div class="flex gap-2 mt-4">
                                <button class="btn btn-secondary btn-sm"
                                    onclick="exportReport('keywords', 'csv')">Export CSV</button>
                                <button class="btn btn-secondary btn-sm"
                                    onclick="exportReport('keywords', 'pdf')">Export PDF</button>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Source Summary Report</h3>
                                <p class="card-description">Documents collected per source</p>
                            </div>
                            <div class="flex gap-2 mt-4">
                                <button class="btn btn-secondary btn-sm" onclick="exportReport('sources', 'csv')">Export
                                    CSV</button>
                                <button class="btn btn-secondary btn-sm" onclick="exportReport('sources', 'pdf')">Export
                                    PDF</button>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Documents Export</h3>
                                <p class="card-description">All crawled documents with metadata</p>
                            </div>
                            <div class="flex gap-2 mt-4">
                                <button class="btn btn-secondary btn-sm"
                                    onclick="exportReport('documents', 'csv')">Export CSV</button>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Crawl Timeline</h3>
                                <p class="card-description">Activity over last 30 days</p>
                            </div>
                            <div class="chart-container">
                                <canvas id="timelineChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Theme Toggle -->
    <div class="theme-toggle">
        <button class="theme-option active" data-theme="dark">Dark</button>
        <button class="theme-option" data-theme="light">Light</button>
    </div>

    <script>
        const API_BASE = '/api';
        let currentTab = 'overview';
    </script>
    <script src="/static/js/sourceManager.js"></script>
    <script src="/static/js/analytics.js"></script>
    <script src="/static/js/app.js"></script>
    <script src="/static/js/charts.js"></script>
    <script src="/static/js/decision.js"></script>
    <script src="/static/js/projects.js"></script>

    <script>
        // Connect Add Source button
        document.getElementById('btn-add-source').addEventListener('click', () => {
            sourceManager.openModal();
        });

        // Theme toggle
        document.querySelectorAll('.theme-option').forEach(btn => {
            btn.addEventListener('click', () => {
                const theme = btn.dataset.theme;

                // Update buttons
                document.querySelectorAll('.theme-option').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                // Apply theme
                if (theme === 'light') {
                    document.body.classList.add('light-mode');
                    localStorage.setItem('theme', 'light');
                } else {
                    document.body.classList.remove('light-mode');
                    localStorage.setItem('theme', 'dark');
                }
            });
        });

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'dark';
        if (savedTheme === 'light') {
            document.body.classList.add('light-mode');
            document.querySelector('[data-theme="light"]').classList.add('active');
            document.querySelector('[data-theme="dark"]').classList.remove('active');
        }
    </script>
</body>

</html>